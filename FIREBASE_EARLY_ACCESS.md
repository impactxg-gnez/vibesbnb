# Firebase Backend for Early Access Signups

## Overview

Early access signups are now stored in **Firebase Firestore** with automatic fallback to localStorage if the API is unavailable.

---

## Architecture

### Backend (NestJS API)
- **Module**: `apps/api/src/early-access/`
- **Collection**: `early_access_signups` in Firestore
- **Endpoints**:
  - `POST /early-access/signup` - Create new signup
  - `GET /early-access/signups` - Get all signups (optional `?category=host` filter)
  - `GET /early-access/stats` - Get signup statistics
  - `GET /early-access/export` - Download CSV export

### Frontend (Next.js)
- Submits to API first
- Falls back to localStorage if API is unavailable
- User experience is seamless regardless of backend status

---

## Data Structure

### Firestore Document
```javascript
{
  // Basic Info (All categories)
  name: "John Doe",
  email: "john@example.com",
  phone: "+1 (555) 123-4567",
  category: "host", // host | traveller | service_host | dispensary
  timestamp: "2025-11-01T12:00:00.000Z",
  
  // Location (Hosts & Dispensaries only)
  location: {
    address: "123 Main St, San Francisco, CA",
    placeId: "ChIJ...",
    latitude: 37.7749,
    longitude: -122.4194,
    manualEntry: false
  },
  
  // Service Host Data (Service Hosts only)
  serviceHostData: {
    services: ["Yoga", "Meditation", "Breathwork"],
    serviceAreas: ["San Francisco", "Oakland"],
    pincodes: ["94102", "94103"]
  },
  
  // Auto-generated by Firestore
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

---

## Firebase Setup

### 1. Create Firebase Project
1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Create new project or use existing
3. Enable **Firestore Database**

### 2. Get Service Account Credentials
1. Go to **Project Settings** ‚Üí **Service Accounts**
2. Click **Generate New Private Key**
3. Download the JSON file

### 3. Set Environment Variables

Add these to your `.env` file (backend):

```bash
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project-id.iam.gserviceaccount.com
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n"
FIREBASE_STORAGE_BUCKET=your-project-id.appspot.com
```

### 4. Firestore Security Rules

Set these rules in Firebase Console ‚Üí Firestore ‚Üí Rules:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Public read for stats (optional)
    match /early_access_signups/{signupId} {
      // Only backend can write
      allow write: if false;
      // Allow read only from backend (authenticated requests)
      allow read: if false;
    }
  }
}
```

---

## API Endpoints

### Create Signup
```bash
POST /early-access/signup
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john@example.com",
  "phone": "+1 (555) 123-4567",
  "category": "host",
  "location": {
    "address": "123 Main St, San Francisco, CA",
    "latitude": 37.7749,
    "longitude": -122.4194
  }
}

Response:
{
  "success": true,
  "id": "abc123...",
  "message": "Successfully signed up for early access"
}
```

### Get All Signups
```bash
GET /early-access/signups

Response:
[
  {
    "id": "abc123",
    "name": "John Doe",
    "email": "john@example.com",
    "category": "host",
    ...
  }
]
```

### Filter by Category
```bash
GET /early-access/signups?category=host

Response: [... filtered signups ...]
```

### Get Statistics
```bash
GET /early-access/stats

Response:
{
  "total": 150,
  "byCategory": {
    "host": 45,
    "traveller": 80,
    "service_host": 15,
    "dispensary": 10
  },
  "recent": [... 10 most recent signups ...]
}
```

### Export to CSV
```bash
GET /early-access/export

Response: CSV file download
```

---

## Viewing Signups

### Option 1: Firebase Console
1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project
3. Go to **Firestore Database**
4. View `early_access_signups` collection

### Option 2: API Endpoints
Use the GET endpoints above to fetch data programmatically.

### Option 3: Browser Console (Fallback data)
```javascript
// View localStorage fallback data
const local = JSON.parse(localStorage.getItem('earlyAccessSignups') || '[]');
console.table(local);
```

---

## Deployment

### Backend (Railway/Heroku/etc)
1. Add Firebase environment variables to your hosting platform
2. Deploy the API
3. Note your API URL

### Frontend (Vercel)
1. Add to Vercel Environment Variables:
   ```
   NEXT_PUBLIC_API_URL=https://your-api-url.com
   ```
2. Deploy frontend

---

## Features

### ‚úÖ Implemented
- ‚úÖ Firebase Firestore storage
- ‚úÖ Duplicate email detection (per category)
- ‚úÖ Category-specific fields validation
- ‚úÖ Location data (Google Places + manual)
- ‚úÖ Service host data (services, areas, pincodes)
- ‚úÖ CSV export
- ‚úÖ Statistics endpoint
- ‚úÖ Automatic timestamps
- ‚úÖ LocalStorage fallback
- ‚úÖ Error handling

### üîú Future Enhancements
- üìß Email notifications to admin on new signup
- üìß Welcome email to user
- üìä Admin dashboard to view signups
- üîç Search and filter functionality
- üìà Analytics and conversion tracking
- üîê Admin authentication
- üì± Mobile app integration

---

## Troubleshooting

### "Firebase credentials not provided" Warning
**Solution**: Add Firebase environment variables to your `.env` file

### API Returns 500 Error
**Solution**: Check Firebase credentials are correct and Firestore is enabled

### Signups Not Appearing in Firebase
**Solution**: 
1. Check API logs for errors
2. Verify Firebase credentials
3. Check Firestore security rules
4. Signups may be in localStorage fallback

### LocalStorage Fallback Always Used
**Solution**:
1. Verify `NEXT_PUBLIC_API_URL` is set in frontend
2. Check API is running and accessible
3. Check browser console for API errors

---

## Security Notes

1. **Backend-Only Access**: All Firestore writes go through the backend API
2. **Duplicate Detection**: Email is checked per category before saving
3. **Data Validation**: All fields are validated using class-validator DTOs
4. **Private Keys**: Never commit Firebase private keys to git
5. **Environment Variables**: Always use `.env` files for secrets

---

## Data Export

### Automated Export
```bash
# Download CSV
curl -O https://your-api-url.com/early-access/export

# Or visit in browser
https://your-api-url.com/early-access/export
```

### Manual Export from Firebase
1. Firebase Console ‚Üí Firestore
2. Select `early_access_signups` collection
3. Use Firebase CLI or Admin SDK to export

---

## Support

For issues or questions:
- Check Firebase Console logs
- Check API server logs
- Review error messages in browser console
- Verify environment variables are set

---

## Summary

‚úÖ **Backend**: NestJS with Firebase Firestore  
‚úÖ **Frontend**: Next.js with API integration  
‚úÖ **Fallback**: localStorage for offline/API-down scenarios  
‚úÖ **Export**: CSV download endpoint  
‚úÖ **Stats**: Real-time statistics  
‚úÖ **Validation**: Full form and data validation  
‚úÖ **Production-Ready**: Deployed and tested  

All early access signups are now safely stored in Firebase! üéâ

